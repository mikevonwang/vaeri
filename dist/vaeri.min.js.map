{"version":3,"sources":["vaeri.js"],"names":["Vaeri","_classCallCheck","this","state","dom","start","_this","addEventListener","getDOM","processDOM","document","querySelectorAll","forEach","c","setListeners","processListeners","onMount","element_list","parent","remove","key","context","vaeri_ref","selector","children","selector_full","vaeri_selector","is_template","Object","assign","_this2","vaeri_children","keys","VaeriElementArray","length","VaeriElement","listener_list","_this3","listeners","template","listen","action_parameters","arguments","undefined","state_updates","action_name","self","vaeri_self","classList","getAttribute","bind","setAttribute","insertAdjacentHTML","link","_this4","l","e","i","call","value","val","links","_this5","push","parentNode","_this6","populate","data","maker","_this7","new_vaeri_element","clone","appendChild","source","index","_this8","elements","cloneNode","child_key","target","_this9","Array","prototype"],"mappings":"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","file":"vaeri.min.js","sourcesContent":["class Vaeri {\n  constructor() {\n    this.state = {};\n    this.dom = {};\n    this.start();\n  }\n\n  start() {\n    document.addEventListener('DOMContentLoaded', () => {\n      if (this.getDOM) {\n        this.dom = this.processDOM(this.getDOM(), document);\n        document.querySelectorAll('*[vaeri-template=true]').forEach((c) => {\n          c.remove();\n        });\n      }\n      if (this.setListeners) {\n        this.processListeners(this.setListeners(), this.dom);\n      }\n      if (this.onMount) {\n        this.onMount();\n      }\n    });\n  }\n\n  processDOM(element_list, parent, is_template) {\n    let dom = {};\n    Object.keys(element_list).forEach((key) => {\n      const context = (parent.vaeri_ref) ? parent.vaeri_ref : document;\n      const selector = element_list[key][0];\n      const children = element_list[key][1];\n      if (typeof selector === 'string') {\n        const selector_full = ((parent.vaeri_selector) ? (parent.vaeri_selector + ' ') : '') + selector;\n        dom[key] = new VaeriElement(this, context, selector_full, null, is_template);\n        if (dom[key].vaeri_ref && children) {\n          Object.assign(dom[key], this.processDOM(children, dom[key]), {\n            vaeri_children: Object.keys(children),\n          });\n        }\n      }\n      else {\n        const selector_full = ((parent.vaeri_selector) ? (parent.vaeri_selector + ' ') : '') + selector[0];\n        dom[key] = new VaeriElementArray(this, context, selector_full);\n        if (dom[key].length > 0 && children) {\n          dom[key].forEach((c) => {\n            Object.assign(c, this.processDOM(children, c), {\n              vaeri_children: Object.keys(children),\n            });\n          });\n          if (dom[key].template) {\n            Object.assign(dom[key].template, this.processDOM(children, dom[key].template, true), {\n              vaeri_children: Object.keys(children),\n            });\n          }\n        }\n      }\n    });\n    return dom;\n  }\n\n  processListeners(listener_list, parent, is_template) {\n    Object.keys(listener_list).forEach((key) => {\n      const listeners = listener_list[key][0];\n      const children = listener_list[key][1];\n      if (listeners !== null && listeners.length > 0) {\n        if (parent.length > 0) {\n          parent.forEach((c) => {\n            c[key].listen(listeners);\n          });\n        }\n        else if (parent[key]) {\n          parent[key].listen(listeners);\n          if (is_template) {\n            parent[key].listeners = listeners;\n          }\n        }\n      }\n      if (children && parent[key]) {\n        this.processListeners(children, parent[key]);\n        if (parent[key].template) {\n          this.processListeners(children, parent[key].template, true);\n        }\n      }\n    });\n  }\n\n  doAction(action_name, state_updates, action_parameters = []) {\n    this.state = Object.assign({}, this.state, state_updates);\n    if (this[action_name]) {\n      this[action_name].call(this, ...action_parameters);\n    }\n  }\n\n}\n\nclass VaeriElement {\n  constructor(self, context, selector, ref, is_template) {\n    this.vaeri_self = self;\n    this.vaeri_ref = (ref) ? ref : context.querySelector(selector);\n    this.vaeri_selector = selector;\n\n    if (this.vaeri_ref) {\n      this.classList = this.vaeri_ref.classList;\n      this.getAttribute = this.vaeri_ref.getAttribute.bind(this.vaeri_ref);\n      this.setAttribute = this.vaeri_ref.setAttribute.bind(this.vaeri_ref);\n      this.insertAdjacentHTML = this.vaeri_ref.insertAdjacentHTML.bind(this.vaeri_ref);\n\n      if (is_template) {\n        this.vaeri_ref.remove();\n      }\n    }\n  }\n\n  listen(listeners, link) {\n    if (listeners) {\n      listeners.forEach((l) => {\n        this.vaeri_ref.addEventListener(l[0], (e) => {\n          let i = (link !== undefined) ? link() : link;\n          l[1].call(this.vaeri_self, e, this.vaeri_ref, i);\n        });\n      });\n    }\n  }\n\n  get value() {\n    return this.vaeri_ref.value;\n  }\n  set value(val) {\n    this.vaeri_ref.value = val;\n  }\n}\n\nfunction VaeriElementArray(self, context, selector) {\n  this.links = [];\n  const elements = context.querySelectorAll(selector);\n  elements.forEach((c) => {\n    if (c.getAttribute('vaeri-template') === null) {\n      this.links.push(this.length);\n      this.push(new VaeriElement(self, null, selector, c));\n    }\n    else {\n      this.template = new VaeriElement(self, null, selector, c);\n      this.parent = c.parentNode;\n    }\n  });\n\n  this.listen = function(listeners) {\n    this.listeners = listeners;\n    this.forEach((c, i) => {\n      c.listen(listeners, this.link.bind(this, i));\n    });\n  };\n\n  this.populate = function(data, maker) {\n    if (data.length === undefined) {\n      data = [data];\n    }\n    data.forEach((c) => {\n      const i = this.length;\n      this.links.push(i);\n      let new_vaeri_element = this.clone(this.template,i);\n      new_vaeri_element.listen(this.listeners, this.link.bind(this, i));\n      this.parent.appendChild(new_vaeri_element.vaeri_ref);\n      this.push(new_vaeri_element);\n      if (maker) {\n        maker.call(self, c, i);\n      }\n    });\n  };\n\n  this.clone = function(source, index) {\n    let target = new VaeriElement(self, null, source.vaeri_selector, source.vaeri_ref.cloneNode(true));\n    if (source.vaeri_children) {\n      source.vaeri_children.forEach((child_key) => {\n        target[child_key] = this.clone(source[child_key], index);\n        target.vaeri_ref.appendChild(target[child_key].vaeri_ref);\n      });\n    }\n    if (source.listeners) {\n      target.listen(source.listeners, this.link.bind(this, index));\n    }\n    return target;\n  };\n\n  this.remove = function(index) {\n    this[index].vaeri_ref.remove();\n    this.splice(index, 1);\n    this.links.forEach((c,i) => {\n      if (c === index) {\n        this.links[i] = null;\n      }\n      else if (c > index) {\n        this.links[i] -= 1;\n      }\n    });\n  };\n\n  this.link = function(index) {\n    return this.links[index];\n  };\n}\nVaeriElementArray.prototype = Array.prototype;\n"]}